<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ランダム鳥画像ビューアー（無料API版）</title>
	<style>
		body {
			font-family: 'Arial', sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			margin: 0;
			padding: 20px;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.container {
			background: rgba(255, 255, 255, 0.95);
			border-radius: 20px;
			padding: 30px;
			box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
			max-width: 700px;
			width: 100%;
			text-align: center;
			backdrop-filter: blur(10px);
		}

		h1 {
			color: #333;
			margin-bottom: 30px;
			font-size: 2.5em;
			background: linear-gradient(45deg, #667eea, #764ba2);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.btn {
			background: linear-gradient(45deg, #667eea, #764ba2);
			color: white;
			border: none;
			padding: 15px 35px;
			border-radius: 30px;
			cursor: pointer;
			font-size: 18px;
			margin: 15px;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
		}

		.btn:hover {
			transform: translateY(-3px);
			box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
		}

		.btn:active {
			transform: translateY(-1px);
		}

		.btn:disabled {
			background: #ccc;
			cursor: not-allowed;
			transform: none;
			box-shadow: none;
		}

		.btn-group {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			gap: 10px;
			margin: 20px 0;
		}

		.btn-small {
			padding: 10px 20px;
			font-size: 14px;
		}

		.image-container {
			margin: 25px 0;
			border-radius: 15px;
			overflow: hidden;
			box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
			position: relative;
			background: #f8f9fa;
			min-height: 400px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.bird-image {
			max-width: 100%;
			max-height: 500px;
			object-fit: contain;
			border-radius: 15px;
			transition: all 0.5s ease;
			cursor: pointer;
		}

		.bird-image:hover {
			transform: scale(1.02);
		}

		.loading {
			color: #667eea;
			font-size: 18px;
			margin: 30px 0;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
		}

		.loading::after {
			content: '';
			width: 20px;
			height: 20px;
			border: 3px solid #f3f3f3;
			border-top: 3px solid #667eea;
			border-radius: 50%;
			animation: spin 1s linear infinite;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		.error {
			color: #e74c3c;
			background: #ffe6e6;
			padding: 20px;
			border-radius: 10px;
			margin: 15px 0;
			border-left: 4px solid #e74c3c;
		}

		.image-info {
			background: linear-gradient(45deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
			color: white;
			padding: 15px;
			font-size: 14px;
			text-align: left;
			border-radius: 0 0 15px 15px;
		}

		.success-badge {
			background: #27ae60;
			color: white;
			padding: 8px 16px;
			border-radius: 20px;
			font-size: 14px;
			font-weight: bold;
			display: inline-block;
			margin-bottom: 20px;
			animation: pulse 2s infinite;
		}

		@keyframes pulse {
			0% {
				transform: scale(1);
			}

			50% {
				transform: scale(1.05);
			}

			100% {
				transform: scale(1);
			}
		}

		.auto-reload {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			margin: 20px 0;
		}

		.auto-reload input[type="checkbox"] {
			transform: scale(1.2);
		}

		.note {
			background: #e8f4fd;
			border: 1px solid #b3d9ff;
			border-radius: 8px;
			padding: 15px;
			margin: 20px 0;
			font-size: 14px;
			text-align: left;
		}

		.stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
			gap: 15px;
			margin: 20px 0;
		}

		.stat-card {
			background: rgba(102, 126, 234, 0.1);
			padding: 15px;
			border-radius: 10px;
			text-align: center;
		}

		.stat-number {
			font-size: 24px;
			font-weight: bold;
			color: #667eea;
		}

		.stat-label {
			font-size: 12px;
			color: #666;
			margin-top: 5px;
		}

		.api-status {
			display: flex;
			justify-content: space-around;
			margin: 15px 0;
			font-size: 12px;
		}

		.api-indicator {
			padding: 5px 10px;
			border-radius: 15px;
			font-weight: bold;
		}

		.api-success {
			background: #d4edda;
			color: #155724;
		}

		.api-failed {
			background: #f8d7da;
			color: #721c24;
		}

		@media (max-width: 600px) {
			.container {
				margin: 10px;
				padding: 20px;
			}

			h1 {
				font-size: 2em;
			}

			.btn-group {
				flex-direction: column;
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>🐦 ランダム鳥画像ビューアー</h1>

		<div class="success-badge">🆓 完全無料・APIキー不要！</div>

		<div class="note">
			<strong>🐦 鳥専用API:</strong><br>
			複数の無料鳥画像APIを自動で試行し、最適な画像を表示します。完全無料でAPIキー登録不要！
		</div>

		<div class="api-status" id="apiStatus">
			<div class="api-indicator api-success">API準備中...</div>
		</div>

		<div class="stats" id="stats">
			<div class="stat-card">
				<div class="stat-number" id="imageCount">0</div>
				<div class="stat-label">表示回数</div>
			</div>
			<div class="stat-card">
				<div class="stat-number" id="apiUsed">-</div>
				<div class="stat-label">使用API</div>
			</div>
			<div class="stat-card">
				<div class="stat-number" id="timeCount">00:00</div>
				<div class="stat-label">経過時間</div>
			</div>
		</div>

		<button class="btn" onclick="loadRandomBirdImage()">🐦 新しい鳥画像を表示</button>

		<div class="auto-reload">
			<input type="checkbox" id="autoReload">
			<label for="autoReload">8秒ごとに自動更新</label>
		</div>

		<div id="loading" class="loading" style="display: none;">
			美しい鳥画像を探しています
		</div>

		<div id="error" class="error" style="display: none;"></div>

		<div id="imageContainer" class="image-container" style="display: none;">
			<img id="birdImage" class="bird-image" alt="鳥の画像">
		</div>

		<div id="imageInfo" class="image-info" style="display: none;"></div>
	</div>

	<script>
		let autoReloadInterval = null;
		let imageCounter = 0;
		let startTime = Date.now();
		let currentApi = 'Unknown';

		// 鳥画像APIのリスト（優先順）
		const birdApis = [
			{
				name: 'Shibe.Online',
				url: 'https://shibe.online/api/birds?count=1&urls=true&httpsUrls=true',
				type: 'array'
			},
			{
				name: 'Some Random API',
				url: 'https://some-random-api.ml/img/bird',
				type: 'object'
			},
			{
				name: 'Random Birds API',
				url: 'https://random-birds-api.herokuapp.com/api/random',
				type: 'object'
			}
		];

		// ページ読み込み時に最初の画像を表示
		window.addEventListener('load', () => {
			loadRandomBirdImage();
			updateTimer();
		});

		// 自動リロード機能
		document.getElementById('autoReload').addEventListener('change', function () {
			if (this.checked) {
				autoReloadInterval = setInterval(loadRandomBirdImage, 8000);
			} else {
				if (autoReloadInterval) {
					clearInterval(autoReloadInterval);
					autoReloadInterval = null;
				}
			}
		});

		// タイマー更新
		function updateTimer() {
			setInterval(() => {
				const elapsed = Math.floor((Date.now() - startTime) / 1000);
				const minutes = Math.floor(elapsed / 60);
				const seconds = elapsed % 60;
				document.getElementById('timeCount').textContent =
					`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
			}, 1000);
		}

		async function loadRandomBirdImage() {
			showLoading(true);
			hideError();
			updateApiStatus('試行中...');

			// APIを順番に試行
			for (let i = 0; i < birdApis.length; i++) {
				const api = birdApis[i];

				try {
					updateApiStatus(`${api.name} を試行中...`);

					const response = await fetch(api.url);

					if (!response.ok) {
						throw new Error(`HTTP ${response.status}`);
					}

					const data = await response.json();
					let imageUrl;

					// レスポンスタイプに応じて画像URLを抽出
					if (api.type === 'array') {
						imageUrl = Array.isArray(data) && data.length > 0 ? data[0] : null;
					} else {
						imageUrl = data.link || data.url || data.image || data.src;
					}

					if (imageUrl) {
						currentApi = api.name;
						updateApiStatus(`${api.name} 成功`, true);
						displayImage(imageUrl, api.name);
						return; // 成功したら終了
					}

				} catch (error) {
					console.warn(`${api.name} failed:`, error);
					updateApiStatus(`${api.name} 失敗`, false);
					continue; // 次のAPIを試行
				}
			}

			// 全てのAPIが失敗した場合、フォールバック画像を生成
			showError('全ての鳥画像APIが利用できません。代替画像を生成します...');
			generateFallbackBirdImage();
		}

		function generateFallbackBirdImage() {
			// SVGで鳥の画像を生成（フォールバック）
			const birdColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
			const randomColor = birdColors[Math.floor(Math.random() * birdColors.length)];

			const birdNames = ['スズメ', 'カラス', 'ハト', 'ツバメ', 'カワセミ', 'フクロウ', 'タカ', 'ワシ'];
			const randomBird = birdNames[Math.floor(Math.random() * birdNames.length)];

			const svgBird = `
                <svg width="400" height="300" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="birdGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:${randomColor};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${randomColor}88;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="400" height="300" fill="#87CEEB"/>
                    <circle cx="80" cy="80" r="30" fill="white" opacity="0.8"/>
                    <circle cx="320" cy="100" r="20" fill="white" opacity="0.6"/>
                    <ellipse cx="200" cy="180" rx="80" ry="50" fill="url(#birdGrad)"/>
                    <circle cx="180" cy="160" r="25" fill="url(#birdGrad)"/>
                    <polygon points="120,160 140,170 130,180" fill="#FFA500"/>
                    <circle cx="165" cy="155" r="5" fill="black"/>
                    <ellipse cx="220" cy="220" rx="15" ry="8" fill="#8B4513"/>
                    <ellipse cx="260" cy="225" rx="15" ry="8" fill="#8B4513"/>
                    <text x="200" y="260" text-anchor="middle" font-family="Arial" font-size="20" fill="#333">${randomBird}</text>
                </svg>
            `;

			const blob = new Blob([svgBird], { type: 'image/svg+xml' });
			const url = URL.createObjectURL(blob);

			currentApi = 'SVG生成';
			updateApiStatus('SVG画像生成', true);
			displayImage(url, 'SVG生成');
		}

		function displayImage(imageUrl, apiName) {
			const img = document.getElementById('birdImage');
			const info = document.getElementById('imageInfo');
			const container = document.getElementById('imageContainer');

			img.onload = function () {
				imageCounter++;

				container.style.display = 'flex';
				info.style.display = 'block';

				const currentTime = new Date().toLocaleString('ja-JP');

				// 統計更新
				document.getElementById('imageCount').textContent = imageCounter;
				document.getElementById('apiUsed').textContent = apiName;

				info.innerHTML = `
                    <strong>🐦 画像提供:</strong> ${apiName}<br>
                    <strong>📷 画像番号:</strong> ${imageCounter}<br>
                    <strong>🕒 取得時刻:</strong> ${currentTime}<br>
                    <strong>✅ ステータス:</strong> 正常動作<br>
                    <strong>🔗 API:</strong> 無料・APIキー不要<br>
                    <em>💡 画像をクリックまたはスペースキーで新しい画像を表示</em>
                `;

				showLoading(false);
			};

			img.onerror = function () {
				console.warn('Image failed to load, trying fallback...');
				if (apiName !== 'SVG生成') {
					generateFallbackBirdImage();
				} else {
					showError('画像の表示に失敗しました。');
					showLoading(false);
				}
			};

			// 画像をクリックで新しい画像を表示
			img.onclick = function () {
				loadRandomBirdImage();
			};

			img.src = imageUrl;
		}

		function updateApiStatus(message, success = null) {
			const statusDiv = document.getElementById('apiStatus');
			if (success === true) {
				statusDiv.innerHTML = `<div class="api-indicator api-success">${message}</div>`;
			} else if (success === false) {
				statusDiv.innerHTML = `<div class="api-indicator api-failed">${message}</div>`;
			} else {
				statusDiv.innerHTML = `<div class="api-indicator">${message}</div>`;
			}
		}

		function showLoading(show) {
			document.getElementById('loading').style.display = show ? 'block' : 'none';
		}

		function showError(message) {
			const errorDiv = document.getElementById('error');
			errorDiv.textContent = message;
			errorDiv.style.display = 'block';
		}

		function hideError() {
			document.getElementById('error').style.display = 'none';
		}

		// キーボードショートカット
		document.addEventListener('keydown', function (event) {
			if (event.code === 'Space') {
				event.preventDefault();
				loadRandomBirdImage();
			}
		});

		// 詳細情報表示
		function showApiDetails() {
			const details = `
🐦 鳥画像API詳細:

✅ Shibe.Online API
   - 鳥、猫、柴犬の画像
   - 完全無料・APIキー不要

✅ Some Random API  
   - 様々な動物画像
   - 完全無料・APIキー不要

✅ SVGフォールバック
   - API失敗時の代替画像
   - カラフルな鳥のイラスト

🎮 操作方法:
- スペースキー: 新しい画像
- 画像クリック: 新しい画像
- 自動更新: チェックボックス
            `;
			alert(details);
		}

		// アプリ情報ボタン
		const infoBtn = document.createElement('button');
		infoBtn.textContent = '📋 API詳細';
		infoBtn.className = 'btn btn-small';
		infoBtn.onclick = showApiDetails;
		document.querySelector('.btn-group').appendChild(infoBtn);
	</script>
</body>

</html>
